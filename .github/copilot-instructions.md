# Arthur's Life App – Copilot Instructions (GPT-4.1)

## 📋 Project Overview

Arthur's Life is a family task management Android app built with Clean Architecture and Domain-Driven Design (DDD). It features a gamified token economy, role-based access, and a robust theme system. This file defines the essential engineering, documentation, and workflow standards for all code and documentation generated by GPT-4.1.

---

## 🛠️ Copilot Workflow (GPT-4.1)

This file defines the essential engineering, documentation, and workflow standards for all code and documentation generated by GitHub Copilot (GPT-4.1) for Arthur's Life App.

- **Always follow the standards below for every code and documentation change.**
- **Reference instructions files directly; do not rely on external memory or context.**
- **Use semantic search and file search to discover requirements, patterns, and implementation details.**
- **Cross-reference PRDs, IPDs, and documentation as needed for traceability.**

---

## 🏗️ Architecture & Code Standards

- **Architecture:** Clean Architecture + DDD (Domain → Infrastructure → Presentation)
- **Domain:** Aggregates (User, Task, Token, Reward, Achievement), Value Objects, Domain Events, Repository Pattern
- **UI:** Jetpack Compose, theme-aware components only (never raw Material), user-based theming (Material Light default, Material Dark, Mario Classic)
- **Navigation:** Unified, role-based navigation via `MainAppNavigation.kt`
- **Dependency Injection:** Hilt, modules organized by feature
- **Testing:** JUnit, Espresso, MockK. 80%+ coverage required for domain
- **Static Analysis:** Detekt (ZERO violations allowed), KtLint
- **Accessibility:** All UI must support TalkBack, semantic roles, 4.5:1 color contrast
- **Child Safety:** Input validation, secure storage, COPPA compliance

---

## 📁 File & Project Structure

- **Kotlin File Order:** Package → Explicit Imports → Code
- **No wildcard imports.** All imports must be explicit.
- **No business logic in composables.** Use string resources, named constants, and immutable data classes.
- **Directory Structure:**
  ```
  com.arthurslife.app/
    domain/           # Business logic, aggregates, value objects
    infrastructure/   # Repository implementations, DAOs, data sources
    presentation/     # Jetpack Compose UI, navigation, ViewModels
    di/               # Hilt modules
    data/             # DataStore, theme management
  ```

---

## 🔧 Build & Quality Pipeline

**MANDATORY SEQUENCE (all must pass, in order):**

```zsh
if [ "$(basename $(pwd))" != "android-kotlin" ]; then
    echo "Navigating to android-kotlin directory..."
    cd android-kotlin
fi

./gradlew detektFormat
./gradlew detekt        # ZERO violations required
./gradlew build
./gradlew test
./gradlew installDebug
```

- **Implementation is INCOMPLETE if any command fails.**

---

## 📚 Documentation Standards

- **All docs** must follow `/docs/DOCUMENTATION_GUIDELINES.md` and `/docs/TEMPLATE.md`.
- **Required sections:** Document Overview, Quick Reference, Main Content, Integration Points, Additional Resources, Contributing.
- **Navigation:** Use emoji-prefixed headings and top/bottom navigation links as in the template.
- **File naming:** kebab-case, descriptive, no spaces or special characters.
- **Update docs** for any API, workflow, or architectural change.

---

## 🚀 Contribution Workflow

- **Start with Domain:** Define entities, value objects, business rules.
- **Implement Use Cases:** In domain layer.
- **Add Infrastructure:** Repository implementations.
- **Build UI:** Theme-aware Compose screens.
- **Wire DI:** Hilt modules by feature.
- **Test:** Comprehensive unit/integration tests.
- **Review:** All code and docs must pass technical and editorial review.

---

## 📝 Commit & PR Guidelines

- Use clear, imperative commit messages.
- Reference issues in PRs.
- Document major decisions in PR descriptions.
- Update documentation for all significant changes.

---

## 🏁 Success Criteria

- **Zero Detekt violations**
- **All tests passing** (80%+ domain coverage)
- **Successful build and installation**
- **Theme compatibility** across all roles
- **Accessibility compliance** (TalkBack, contrast)
- **Memory Bank maintenance** (current context)
- **Cross-referenced documents**
- **Markdown standards compliance**
- **Architectural decisions documented**
- **Traceability between PRDs, IPDs, and tasks**

---

## 🔍 Search & Analysis Strategy

- Use semantic search for broad concept discovery
- Use file search for specific patterns
- Check Memory Bank for current context
- Verify against PRDs for requirements
- Cross-reference IPDs for implementation plans

---

## 🧪 Testing Strategy

- **80%+ coverage for domain layer (mandatory)**
- **Unit tests** for all business logic
- **Integration tests** for repository implementations
- **UI tests** for critical user flows
- **Accessibility tests** for all interactive elements
- **Given-When-Then** structure for all tests
- **MockK** for mocking dependencies
- **Happy path and error scenario coverage**
- **Test data factories** for consistent test data
- **Parameterized tests** for multiple scenarios

---

## 🚨 Error Handling

- **Domain Layer:** Custom exceptions, result patterns, validation at aggregate boundaries, domain events for error notifications
- **Infrastructure Layer:** Repository exceptions, transaction handling, network failure resilience, data consistency validation
- **Presentation Layer:** User-friendly error messages, loading states, error recovery options, accessibility for error states

---

## 🔒 Security & Accessibility

- **Input validation** for all user inputs
- **Secure storage** for sensitive data
- **COPPA compliance** for child safety
- **No PII collection** or external integrations
- **Defense-in-depth** security architecture
- **TalkBack support** for all interactive elements
- **Semantic roles** for UI components
- **4.5:1 color contrast** ratio minimum
- **contentDescription** for all images
- **Proper heading hierarchy** for navigation

---

## 🎨 Theme System

- **User-based theme selection:** All users can select any theme (Material Light, Material Dark, Mario Classic)
- **Default:** Material Light theme for all users
- **Theme-aware terminology:** Adapts to selected theme
- **Accessibility compliance:** 4.5:1 contrast ratio
- **Never use raw Material components directly**
- **Semantic mapping for shared components**

---

## 📖 How to Use This File

- **Mandatory for all code and documentation generation**
- **Read before every session**
- **When in doubt, check Memory Bank and documentation standards**

---

**ZERO TOLERANCE POLICY:**
All code and documentation must comply with these standards. Any violation blocks completion.

---

**Navigation:** [🏠 Docs Hub](../docs/README.md) | [🏠 Main README](../README.md)
